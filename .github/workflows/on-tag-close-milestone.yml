name: on-tag-close-milestone
on: 
  push:
    tags:
      - '[0-9]+\.[0-9]+\.[0-9]+'
jobs:
  close-milestone:
    runs-on: windows-latest
    steps:
    - name: Set tag name
      run: echo ::set-output name=tag::${GITHUB_REF:10}
    - name: Set repo owner
      run: echo ::set-output name=owner::${GITHUB_REPOSITORY:~0,10}
    - name: install GitReleaseManager.Tool
      run: dotnet tool install --global GitReleaseManager.Tool
    - name: Set repo name
      run: echo ::set-output name=repo::${GITHUB_REPOSITORY:11}
    - run: '${{MY_ENV_VAR}}\.dotnet\tools\dotnet-gitreleasemanager.exe create -m ${{steps.vars.outputs.tag}} --token ${{secrets.GITHUB_TOKEN}} -o ${{steps.vars.outputs.owner}} -r ${{steps.vars.outputs.repo}}'
    - run: '${{MY_ENV_VAR}}\.dotnet\tools\dotnet-gitreleasemanager.exe close -m ${{steps.vars.outputs.tag}} --token ${{secrets.GITHUB_TOKEN}} -o ${{steps.vars.outputs.owner}} -r ${{steps.vars.outputs.repo}}'
